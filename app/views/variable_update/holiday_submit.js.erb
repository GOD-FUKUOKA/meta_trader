<% if @error %>
alert("An error occured while executing this operation");
<% elsif @new && @result[:success] %>
  $("#holiday_new_record").val("true");
  $(".holiday_table").append('<%= escape_javascript(render "variable_update/holiday_row", :row => @data, :ix => @data["position"]) %>');
  $("#holiday_tab_position").val('<%= @data["position"].to_i + 1 %>');
  $("input[name='holiday_tab[enable]'][type='checkbox']").prop("checked", true);
  $(".holiday_row[data-position=<%=@data['position']%>] .holiday-edit").click(function(){
    $("#holiday_tab_position").val($(this).parent().parent().attr("data-position"));
    var enabled = $(this).parent().parent().attr("data-enable") == 1;
    $("input[name='holiday_tab[enable]'][type='checkbox']").prop("checked", enabled);
    $("#holiday_tab_month").val($(this).parent().parent().attr("data-month"));
    $("#holiday_tab_day").val($(this).parent().parent().attr("data-day"));
    var year = $(this).parent().parent().attr("data-year");
    if(year=="0"){
      $("#holiday_tab_yearly_check").prop("checked", true);
      $("#holiday_tab_year").val("0").hide();
    }else{
      $("#holiday_tab_yearly_check").prop("checked", false);
      $("#holiday_tab_year").val(year).show();
    }
    var from = $(this).parent().parent().attr("data-from");
    $("#holiday_tab_from_hour").val(parseInt(from/60));
    $("#holiday_tab_from_minute").val(parseInt(from)-(parseInt(from/60)*60));
    var to = $(this).parent().parent().attr("data-to");
    $("#holiday_tab_to_hour").val(parseInt(to/60));
    $("#holiday_tab_to_minute").val(parseInt(to)-(parseInt(to/60))*60);
    $("#holiday_tab_comment").val($(this).parent().parent().attr("data-comment"));
    $("#holiday_tab_symbol").val($(this).parent().parent().attr("data-symbol"));
    $("#holiday_tab_description").val($(this).parent().parent().attr("data-description"));
    $("#holiday_new_record").val("false");
    $("#modal-holiday").modal();
    return false;
  });
  $("#holiday_tab_month").val("");
  $("#holiday_tab_day").val("");
  $("#holiday_tab_yearly_check").prop("checked", false);
  $("#holiday_tab_yearly_check").parent().removeClass("checked");
  $("#holiday_tab_year").val("").show();
  $("#holiday_tab_from_hour").val("");
  $("#holiday_tab_from_minute").val("");
  $("#holiday_tab_to_hour").val("");
  $("#holiday_tab_to_minute").val("");
  $("#holiday_tab_comment").val("");
  $("#holiday_tab_symbol").val("");
  $("#holiday_tab_description").val("");
<% elsif @result[:success] %>
  $("#holiday_new_record").val("true");
  var row = $(".holiday_row[data-position='<%= @data['position']%>']")[0];
  $(row).attr("data-day", "<%= @data['day'] %>");
  $(row).attr("data-month", "<%= @data['month'] %>");
  $(row).attr("data-year", "<%= @data['year'] %>");
  $(row).attr("data-from", "<%= @data['from'] %>");
  $(row).attr("data-to", "<%= @data['to'] %>");
  $(row).attr("data-symbol", "<%= @data['symbol'] %>");
  $(row).attr("data-description", "<%= @data['description'] %>");
  $(row).attr("data-enable", "<%= @data['enable'] %>");
  $($(row).find("td")[0]).text("<%= @data['year']=='0' ? '****' : @data['year'] %>.<%= @data['month'] %>.<%= @data['day'] %>");
  $($(row).find("td")[1]).text("<%= @data['from']['hour'].to_s.rjust(2, '0') %>:<%= @data['from']['minute'].to_s.rjust(2, '0') %>");
  $($(row).find("td")[2]).text("<%= @data['to']['hour'].to_s.rjust(2, '0') %>:<%= @data['to']['minute'].to_s.rjust(2, '0') %>");
  $($(row).find("td")[3]).text("<%= @data['symbol'] %>");
  $($(row).find("td")[4]).text("<%= @data['description'] %>");
  var last_position = $(".holiday_table").find("tr").last().attr("data-position");
  $("#holiday_tab_position").val(last_position + 1);
  $("input[name='holiday_tab[enable]'][type='checkbox']").prop("checked", true);
  $("#holiday_tab_month").val("");
  $("#holiday_tab_day").val("");
  $("#holiday_tab_yearly_check").prop("checked", false);
  $("#holiday_tab_year").val("").show();
  $("#holiday_tab_from_hour").val("");
  $("#holiday_tab_from_minute").val("");
  $("#holiday_tab_to_hour").val("");
  $("#holiday_tab_to_minute").val("");
  $("#holiday_tab_comment").val("");
  $("#holiday_tab_symbol").val("");
  $("#holiday_tab_description").val("");
<% elsif !@result[:success] %>
  alert("<%= @result[:msg] %>");
<% end %>